#!/bin/bash
set -ex;
    
APP_NAME=${1:-none};
UPDATE_PATH=${2:-none};
CATALINA_HOME=${CATALINA_HOME:-none};
    
if [[ "${CATALINA_HOME}" != "none" ]];then
    APP_LOCAL="";
    APP_PATH="${UPDATE_PATH}/${APP_NAME}.war";
    DEPLOY_PATH="${CATALINA_HOME}/webapps";
    if [ -f "${CATALINA_HOME}/webapps/${APP_NAME}.war" ];then
        APP_LOCAL=$(sha1sum "${DEPLOY_PATH}/${APP_NAME}.war" | awk '{print $1}');
        echo "App Updater: Application exists, sha1: ${APP_LOCAL}";
    else 
        echo "App Updater: Application DOES NOT exist and will be deployed from: ${APP_PATH}";
    fi
    if [ -f "${APP_PATH}" ]; then
        APP_LATEST=$(sha1sum ${APP_PATH} | awk '{print $1}');
        if [ "${APP_LOCAL}" != "${APP_LATEST}" ];then
            echo "App Updater: Update is needed, using update path: ${APP_PATH}";
            cp ${APP_PATH} ${DEPLOY_PATH};
        else
            echo "App Updater: Update is not needed";
        fi;
    else 
        echo "App Updater: Application not found at ${APP_PATH}";
    fi;
fi;
